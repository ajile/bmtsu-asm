# Запуск дебагера, для запуска исполняемого файла и его отладки
debug: main
	lldb --one-line "b start" --one-line "r" --one-line "reg r" --file main

# Отображение результата компиляции:
# - Опция -l включает указание на файл-исходник и номер строки
# - Опция -S включает отображение соотв. строки из файла-исходника
# 
# Линкер:
# - Опция macosx_version_min определяет минимальную версию ОС под которую нужно собрать приложение
# - Опция -o определяет имя файла куда будет положен результат линковки
# - Опция -m требует создать 32-битный исполняемый файл
main: main.o
	objdump -S -l ./main.o && \
	ld -macosx_version_min 10.7.0 -lSystem -o main ./main.o -m

# Компиляция программы:
# - Опция -f определяет формат объекта на выходе; Формат `macho` используется в MacOS.
# - Опция -o определяет имя файла - объекта
# - Опция -t включает совместимость с MASM
# - Опция -g включает в результат отладочную информацию
# - Опция -l определяет файл-листинга
main.o: main.asm
	nasm -f macho -o ./main.o main.asm -t -g -l main.list

# Команда очистки билдов
clean:
	rm -rf main main.o main.list
